include "/etc/pf.conf.local"

set skip on lo

block return log

# allow inbound ssh
pass in log proto tcp from any to any port {ssh 2022 19022}

# allow inbound ikev2
pass in log on $ext_if proto udp from any to $ext_ip port {isakmp ipsec-nat-t} tag IKED
pass in log on $ext_if proto esp from any to $ext_ip tag IKED

# allow outbound ikev2 to vpn.kmx.io
pass out log on $ext_if proto udp from $ext_ip to vpn.kmx.io port {isakmp ipsec-nat-t} tag IKED
pass out log on $ext_if proto esp from $ext_ip to vpn.kmx.io tag IKED

# skip vpn
set skip on enc0

# allow inbound http
pass in log proto tcp from any to $ext_ip port {http https}

# allow outbound dns
pass out log proto {tcp udp} from $ext_ip to $dns_ip port domain

# allow outbound to openbsd
pass out log proto tcp from $ext_ip to cdn.openbsd.org port 443 user root

# allow rubygems
pass out log proto tcp from $ext_ip to rubygems.org port 443

# allow icmp
pass log proto icmp from any to any

# allow ntp
pass out proto {tcp udp} from $ext_ip to any port ntp user _ntp

# allow power users
pass out log proto {tcp udp} from $ext_ip to any user {dx vrizzt}

# seuldanslenoir-staging
pass out log proto tcp from $ext_ip to any port https user seuldanslenoir-staging

# allow user _pandoc
#pass out log proto tcp from $ext_ip to any port {http https git} user _pandoc
#pass out log proto udp from $ext_ip to any port {git} user _pandoc

# wilrib
pass in log proto tcp from any to $ext_ip port {7000,8000}

# allow root
pass out log proto tcp from $ext_ip to any port whois user root
